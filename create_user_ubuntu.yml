#create account

---
- hosts:  all
  become: yes

  tasks:
    - name: create group
      group: "{{ user_name }}"
      state: present
      
    - name: create the user/pw
      user:
        name: "{{ user_name }}"
        password: "{{ user_password | password_hash('sha512') }}"
        shell: /bin/bash
        groups: "{{ user_name }}", admin
        append: yes
        createhome: yes
        home: /home/"{{ user_name }}"
        state: present
        
    - name: allow ubuntu user to have passwordless sudo
      lineinfile:
        dest: /etc/sudoers
        line: "{{ user_name }}   ALL=(ALL:ALL) NOPASSWD: ALL"
        validate: 'visudo -cf %s'
        state: present

#    - name: set up authorized keys for the user
#      authorized_key: user="{{ user_name }}" key="{{item}}"
#      with_file:
#      - ~/.ssh/id_rsa.pub

# 변수정의
  vars:
    user_name: ubuntu
    user_password: qwer1234
